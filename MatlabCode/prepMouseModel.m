%Runs prepInitModel for Mouse-GEM, including filtering of reactions.
cd 'C:/Work/MatlabCode/projects/SingleCellModeling/SingleCellModeling/MatlabCode'

%load Human-GEM and tasks
load('C:/Work/MatlabCode/components/MouseGEM/Mouse-GEM/model/Mouse-GEM.mat')
taskStruct = parseTaskList('../data/metabolicTasks_Essential.txt');
%Spontaneous reactions:
rxns_tsv = importTsvFile('C:/Work/MatlabCode/components/MouseGEM/Mouse-GEM/model/reactions.tsv');
spont = rxns_tsv.spontaneous;
spontRxnNames = rxns_tsv.rxns(spont == 1);%very few

%remove drug reactions from the model - we don't need them
m = removeDrugReactions(mouseGEM);
m = removeUnwantedReactions(m);
%remove all AA triplet rxns, i.e. rxns of the type
%2 H2O[c] + Tryptophanyl-Glycyl-Aspartate[c] <=> aspartate[c] + glycine[c] + tryptophan[c]
%This is only used for import of such compounds, and if you don't have that in your "medium",
%which we usually don't, these are pretty pointless.
AATriplets = getAATripletReactions(m,false);
%length(AATriplets)%735
m = removeReactions(m, AATriplets);

%prepare some reactions that can always be on:

%protein reactions creation/degradation

proteinRxns = { ...
    'MAR05155'; ...
    'MAR05156'; ...
    'MAR05161'; ...
    'MAR05167'; ...
    'MAR05168'; ...
    'MAR05169'; ...
    'MAR05170'; ...
    'MAR05171'; ...
    'MAR05172'; ...
    'MAR05174'; ...
    'MAR05260'; ...
    'MAR05262'; ...
    'MAR05264'; ...
    'MAR05266'; ...
    'MAR05267'; ...
    'MAR05268'; ...
    'MAR05269'; ...
    'MAR05270'; ...
    'MAR05271'; ...
    'MAR05273'; ...
    'MAR05275'; ...
    'MAR05277'; ...
    'MAR05279'; ...
    'MAR05281'; ...
    'MAR05283'; ...
    'MAR05291'; ...
    'MAR09817'; ...
    'MAR09818'};

%reactions that just pool metabolites
poolRxns = { ...
    'MAR00011'; ...
    'MAR00012'; ...
    'MAR00477'; ...
    'MAR05233'; ...
    'MAR05234'; ...
    'MAR05238'; ...
    'MAR05239'; ...
    'MAR05243'; ...
    'MAR05244'; ...
    'MAR05247'; ...
    'MAR09022'; ...
    'MAR00015'; ...
    'MAR00016'; ...
    'MAR00017'; ...
    'MAR10033'; ...
    'MAR10035'; ...
    'MAR10036'; ...
    'MAR10037'; ...
    'MAR10038'; ...
    'MAR10062'; ...
    'MAR10063'; ...
    'MAR10064'; ...
    'MAR10065'; ...
    'MAR13082'};


extraSpontRxns = { ...
    'MAR05127'; ...
    'MAR08749'; ...
    'MAR08750'};

radicalRxns = { ...
    'MAR06605'; ...
    'MAR06606'; ...
    'MAR06607'; ...
    'MAR06611'; ...
    'MAR06608'; ...
    'MAR02445'; ...
    'MAR04552'; ...
    'MAR04553'; ...
    'MAR06456'; ...
    'MAR06457'; ...
    'MAR06459'; ...
    'MAR03168'; ...
    'MAR04007'; ...
    'MAR12125'};

%We can also fix a few GPRs that I happened to stumble upon
%MAR11430: EC 4.1.1.3, KEGG: R00217, GPR: hmm, maybe a bit complicated after all, this is not the common version, this is in the cytosol

customRxnsToIgnore = unique([proteinRxns;poolRxns;extraSpontRxns;radicalRxns]);
length(customRxnsToIgnore) %69

prepDataMouseGEM = prepINITModel(m, taskStruct, spontRxnNames, false, customRxnsToIgnore);
save('../data/prepDataMouseGEM.mat','prepDataMouseGEM');

%x = prepDataHumanGEM.toIgnoreExch | prepDataHumanGEM.toIgnoreImportRxns | prepDataHumanGEM.toIgnoreSimpleTransp | prepDataHumanGEM.toIgnoreAdvTransp | prepDataHumanGEM.toIgnoreSpont | prepDataHumanGEM.toIgnoreS;
%sum(x)
%sum(prepDataHumanGEM.toIgnoreAllWithoutGPRs & ~x)%902 rxns extra if we skip all rxns without GPRs

%constructEquations(prepDataHumanGEM.refModel, prepDataHumanGEM.refModel.rxns(prepDataHumanGEM.toIgnoreAllWithoutGPRs & ~x))


